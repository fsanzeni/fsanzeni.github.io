<footer id="site-footer" class="py-10 print:hidden">
  {{/* Footer menu */}}
  {{ if .Site.Params.footer.showMenu | default true }}
    {{ if .Site.Menus.footer }}
      {{ $onlyIcon := true }}
      {{ range .Site.Menus.footer }}
        {{ if .Name }}
          {{ $onlyIcon = false }}
          {{ break }}
        {{ end }}
      {{ end }}
      {{ $navClass := printf "flex flex-row pb-4 text-base font-medium text-neutral-500 dark:text-neutral-400 %s" (cond $onlyIcon "overflow-x-auto py-2" "") }}
      {{ $ulClass := printf "flex list-none %s" (cond $onlyIcon "flex-row" "flex-col sm:flex-row") }}
      {{ $liClass := printf "flex mb-1 text-end sm:mb-0 sm:me-7 sm:last:me-0 %s" (cond $onlyIcon "me-4" "") }}
      <nav class="{{ $navClass }}">
        <ul class="{{ $ulClass }}">
          {{ range .Site.Menus.footer }}
            <li class=" {{ $liClass }}">
              <a
                class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2 flex items-center"
                href="{{ .URL }}"
                title="{{ .Title }}">
                {{ if .Pre }}
                  <span {{ if and .Pre .Name }}class="mr-1"{{ end }}>
                    {{ partial "icon.html" .Pre }}
                  </span>
                {{ end }}
                {{ .Name | markdownify }}
              </a>
            </li>
          {{ end }}
        </ul>
      </nav>
    {{ end }}
  {{ end }}

  <div id="git-status" class="mb-4 text-xs font-mono text-neutral-500 dark:text-neutral-400 border-t border-neutral-200 dark:border-neutral-800 pt-4">
    <span class="animate-pulse" style="color: rgb(var(--color-primary-500));">●</span> INITIALISING UPLINK...
  </div>

  <div class="flex items-center justify-between">
    {{/* Copyright */}}
    {{ if .Site.Params.footer.showCopyright | default true }}
      <p class="text-sm text-neutral-500 dark:text-neutral-400">
        {{- with replace .Site.Params.copyright "{ year }" now.Year }}
          {{ . | markdownify }}
        {{- else }}
          &copy;
          {{ now.Format "2006" }}
          {{ .Site.Params.Author.name | markdownify }}
        {{- end }}
      </p>
    {{ end }}


    {{/* Theme attribution */}}
    {{ if .Site.Params.footer.showThemeAttribution | default true }}
      <p class="text-xs text-neutral-500 dark:text-neutral-400">
        {{ $hugo := printf `<a class="hover:underline hover:decoration-primary-400 hover:text-primary-500"
          href="https://gohugo.io/" target="_blank" rel="noopener noreferrer">Hugo</a>`
        }}
        {{ $blowfish := printf `<a class="hover:underline hover:decoration-primary-400 hover:text-primary-500"
          href="https://blowfish.page/" target="_blank" rel="noopener noreferrer">Blowfish</a>`
        }}
        {{ i18n "footer.powered_by" (dict "Hugo" $hugo "Theme" $blowfish) | safeHTML }}
      </p>
    {{ end }}
  </div>
  {{ if not .Site.Params.disableImageZoom | default true }}
    <script>
      mediumZoom(document.querySelectorAll("img:not(.nozoom)"), {
        margin: 24,
        background: "rgba(0,0,0,0.5)",
        scrollOffset: 0,
      });
    </script>
  {{ end }}
  {{ $jsProcess := resources.Get "js/process.js" }}
  {{ $jsProcess = $jsProcess | resources.Minify | resources.Fingerprint (.Site.Params.fingerprintAlgorithm | default "sha512") }}
  <script
    type="text/javascript"
    src="{{ $jsProcess.RelPermalink }}"
    integrity="{{ $jsProcess.Data.Integrity }}"></script>
  {{/* Extend footer - eg. for extra scripts, etc. */}}
  {{ if templates.Exists "partials/extend-footer.html" }}
    {{ partialCached "extend-footer.html" . }}
  {{ end }}
</footer>
<script>
document.addEventListener("DOMContentLoaded", function() {
  const username = "fsanzeni"; 
  const statusEl = document.getElementById("git-status");

  if (statusEl) {
    statusEl.innerHTML = '<span class="animate-pulse">●</span> SEARCHING UPLINK...';

    fetch(`https://api.github.com/users/${username}/events/public`)
      .then(response => {
        if (!response.ok) throw new Error(`HTTP ${response.status}`);
        return response.json();
      })
      .then(data => {
        // 1. Try to find a PushEvent with actual commits
        const pushEvent = data.find(event => 
          event.type === "PushEvent" && 
          event.payload.commits && 
          event.payload.commits.length > 0
        );

        if (pushEvent) {
          const repo = pushEvent.repo.name.split("/")[1];
          const sha = pushEvent.payload.commits[0].sha.substring(0, 7);
          const message = pushEvent.payload.commits[0].message.split("\n")[0]; // First line only
          
          // Fix: Added rgb() wrapper for the color variable
          statusEl.innerHTML = `
            <span style="color: rgb(var(--color-primary-500))">●</span> 
            LAST COMMIT: <a href="https://github.com/${pushEvent.repo.name}/commit/${sha}" target="_blank" class="hover:underline" style="color:inherit; text-decoration:none;">${sha}</a> 
            :: ${repo.toUpperCase()} 
            // "${message}"
          `;
        } else {
          // 2. Fallback: If no code pushed recently, show the latest activity type
          const lastEvent = data[0];
          if (lastEvent) {
             const repo = lastEvent.repo.name.split("/")[1];
             const type = lastEvent.type.replace('Event', '').toUpperCase();
             statusEl.innerHTML = `
                <span style="color: rgb(var(--color-neutral-500))">○</span> 
                LAST ACTIVITY: ${type} @ ${repo.toUpperCase()}
             `;
          } else {
             statusEl.innerText = "SYSTEM STATUS: OFFLINE (NO PUBLIC ACTIVITY)";
          }
        }
      })
      .catch(err => {
        console.error("Git status error:", err);
        statusEl.innerHTML = `<span style="color: red">✖</span> CONNECTION FAILED`;
      });
  }
});
</script>
